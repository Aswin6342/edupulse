{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="fw-bold">üí¨ Ask Your Mentor</h2>
  <a href="{% url 'dashboard' %}" class="btn btn-outline-primary rounded-pill shadow-sm">
    ‚Üê Back to home
  </a>
</div>

<div class="card shadow-lg border-0">
  <div class="card-header bg-gradient-primary text-white">
    <h5 class="mb-0">üì® Chat with Mentor</h5>
  </div>

  <div class="card-body d-flex flex-column" style="height: 75vh;">
    
    <!-- Chat messages -->
    <div id="chat-box" class="flex-grow-1 mb-3 p-3 chat-box rounded">
      {% if messages %}
        {% for message in messages reversed %}
          <!-- Student message -->
          <div class="d-flex justify-content-end mb-3">
            <div class="chat-bubble student">
              <strong class="d-block small">You</strong>
              <p class="mb-1">{{ message.question }}</p>
              <small class="text-white-50">{{ message.created_at|date:"M d, Y H:i" }}</small>
            </div>
          </div>

          <!-- Mentor reply -->
          {% if message.reply %}
            <div class="d-flex justify-content-start mb-3">
              <div class="chat-bubble mentor">
                <strong class="d-block small">Mentor</strong>
                <p class="mb-1">{{ message.reply }}</p>
                <small class="text-white-50">{{ message.created_at|date:"M d, Y H:i" }}</small>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      {% else %}
        <p class="text-muted text-center my-auto">No messages yet. Start the conversation!</p>
      {% endif %}
    </div>

    <!-- New message input -->
    <form method="post" class="d-flex chat-input">
      {% csrf_token %}
      <textarea name="question" class="form-control rounded-pill px-3 me-2 shadow-sm" 
                rows="1" placeholder="Type your message..." required></textarea>
      <button type="submit" class="btn btn-primary rounded-pill px-4 shadow-sm">Send</button>
    </form>
  </div>
</div>

<!-- Auto-scroll to bottom -->
<script>
  const chatBox = document.getElementById("chat-box");
  if (chatBox) {
    chatBox.scrollTop = chatBox.scrollHeight; // always jump to the latest message
  }
</script>

<style>
  /* Chat Area */
  .chat-box {
    background: linear-gradient(135deg, #f9f9f9, #eef2f7);
    overflow-y: auto;
    border: 1px solid #e0e0e0;
  }

  /* Chat Bubbles */
  .chat-bubble {
    padding: 10px 15px;
    border-radius: 18px;
    max-width: 70%;
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    animation: fadeIn 0.3s ease-in-out;
  }
  .chat-bubble.student {
    background: linear-gradient(135deg, #4facfe, #00f2fe);
    color: white;
    border-bottom-right-radius: 5px;
  }
  .chat-bubble.mentor {
    background: linear-gradient(135deg, #43e97b, #38f9d7);
    color: white;
    border-bottom-left-radius: 5px;
  }

  /* Input Box */
  .chat-input textarea {
    resize: none;
    height: 45px;
  }

  /* Header Gradient */
  .bg-gradient-primary {
    background: linear-gradient(135deg, #667eea, #764ba2);
  }

  /* Animations */
  @keyframes fadeIn {
    from {opacity: 0; transform: translateY(5px);}
    to {opacity: 1; transform: translateY(0);}
  }
</style>

{% endblock %}
