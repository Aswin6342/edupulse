{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>💬 Ask Your Mentor</h2>
  <a href="{% url 'dashboard' %}" class="btn btn-outline-primary">← Back to Dashboard</a>
</div>

<div class="card shadow">
  <div class="card-header">
    <h5>📨 Chat with Mentor</h5>
  </div>

  <div class="card-body d-flex flex-column" style="height: 70vh;">
    <!-- Chat messages -->
    <div id="chat-box" class="flex-grow-1 mb-3 p-3 border rounded bg-light overflow-auto">
      {% if messages %}
        {% for message in messages %}
          <!-- Student message -->
          <div class="d-flex justify-content-end mb-2">
            <div class="p-2 px-3 bg-primary text-white rounded-3 shadow-sm text-end" 
                 style="max-width: 70%; border-bottom-right-radius: 0.5rem;">
              <strong class="d-block">You</strong>
              <p class="mb-1">{{ message.question }}</p>
              <small class="text-white-50">{{ message.created_at|date:"M d, Y H:i" }}</small>
            </div>
          </div>

          <!-- Mentor reply -->
          {% if message.reply %}
            <div class="d-flex mb-2">
              <div class="p-2 px-3 bg-success text-white rounded-3 shadow-sm" 
                   style="max-width: 70%; border-bottom-left-radius: 0.5rem;">
                <strong class="d-block">Mentor</strong>
                <p class="mb-1">{{ message.reply }}</p>
                <small class="text-white-50">{{ message.created_at|date:"M d, Y H:i" }}</small>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      {% else %}
        <p class="text-muted text-center">No messages yet. Start the conversation!</p>
      {% endif %}
    </div>

    <!-- New message input -->
    <form method="post" class="d-flex">
      {% csrf_token %}
      <textarea name="question" class="form-control me-2" rows="1" placeholder="Type your message..." required></textarea>
      <button type="submit" class="btn btn-primary">Send</button>
    </form>
  </div>
</div>

<!-- Auto-scroll to bottom -->
<script>
  var chatBox = document.getElementById("chat-box");
  if (chatBox) {
    chatBox.scrollTop = chatBox.scrollHeight;
  }
</script>
{% endblock %}
